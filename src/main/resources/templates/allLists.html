<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>Messages</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel="stylesheet" href="/style/style.css">
</head>
<body>
<header>
    <!--suppress CheckEmptyScriptTag -->
    <div th:insert="navBar::navbar"/>
</header>

<div th:switch = "${#root}" class="left_block" >

    <p th:case = "messages">
        <div th:if="${messages}" >
            <div th:each="message : ${messages}">
                <div class="card">
                    <div class="card-body m-2">
                        <h4 class="card-header" th:text="${message.getDescription}">a</h4>
                        <a class="button" data-bs-toggle="collapse" th:href="'#content' + ${message.getId}" role="button" aria-expanded="false" aria-controls="content">Детали</a>
                        <div class="card-text collapse" th:id="'content' + ${message.getId}">
                            <label for="id">Номер заявки</label>
                            <p id="id" th:text="${message.getId}">a</p>
                            <label for="status">Статус заявки</label>
                            <p id="status" th:text="${message.getStatus}">a</p>
                            <label for="type">Тип неполадки</label>
                            <p id="type" th:text="${message.getType.getDescription}">a</p>
                            <label for="priority">Приоритет</label>
                            <p id="priority" th:text="${message.getPriority.getDescription}">a</p>
                            <label for="user">Автор</label>
                            <p id="user">
                                <span th:text="${message.getUser.getFirst_name}"></span>
                                <span th:text="${message.getUser.getLast_name}"></span>
                            </p>
                            <button th:if="${message.getActual}" sec:authorize="hasRole('ADMIN')" th:onclick="window.location.href = '/admin/delete/message/[[${message.getId}]]';" type="button">Удалить</button>
                            <button sec:authorize="hasRole('SUPPORT')" th:if="${message.getSupport_id} eq 0" th:onclick="window.location.href = '/support/apply/[[${message.getId}]]';" type="button">Взять в работу</button>
                            <button sec:authorize="hasRole('SUPPORT')" th:unless="${message.getSupport_id} eq 0" th:onclick="window.location.href = '/support/complete/[[${message.getId}]]';" type="button">Завершить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <p th:case="users">
        <p th:if="${users}">
            <button  type="button" data-bs-toggle="modal" data-bs-target="#formNew">New User</button>

            <div th:if="${users}" >
                <div th:each="message : ${users}">
                    <div class="card">
                        <div class="card-body m-2">
                            <h4 class="card-header" th:text="${message.getFirst_name + ' ' + message.getLast_name}">a</h4>
                            <a class="button" data-bs-toggle="collapse" th:href="'#content' + ${message.getId}" role="button" aria-expanded="false" aria-controls="content">Детали</a>
                            <div class="card-text collapse" th:id="'content' + ${message.getId}">
                                <label for="idUser">Номер</label>
                                <p id="idUser" th:text="${message.getId}">a</p>
                                <label for="username">Логин</label>
                                <p id="username" th:text="${message.getUsername}">a</p>
                                <button th:method="delete" sec:authorize="hasRole('ADMIN')" th:onclick="window.location.href = '/admin/delete/user/[[${message.getId}]]';" type="button">Удалить</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
<!--ggh-->
    <p th:case="types">

        <p th:if="${types}">
            <button data-bs-toggle="modal" data-bs-target="#formNew" type="button">New Type</button>

            <div th:if="${types}" >
                <div th:each="message : ${types}">
                    <div class="card">
                        <div class="card-body m-2">
                            <label for="idType">ID</label>
                            <span id="idType" th:text="${message.getId}"></span>
                            <label for="descriptionType">Описание</label>
                            <span id="descriptionType" th:text="${message.getDescription}"></span>
                            <button th:onclick="window.location.href = '/admin/delete/type/[[${message.getId}]]';" type="button">Удалить</button>
                        </div>
                    </div>
                </div>
            </div>

    <p th:case="priorities">

        <p th:if="${priorities}">
            <button data-bs-toggle="modal" data-bs-target="#formNew" type="button">New Priority</button>

            <div th:if="${priorities}" >
                <div th:each="message : ${priorities}">
                    <div class="card">
                        <div class="card-body m-2">
                            <label for="idPriority">ID</label>
                            <span id="idPriority" th:text="${message.getId}"></span>
                            <label for="descriptionPriority">Описание</label>
                            <span id="descriptionPriority" th:text="${message.getDescription}"></span>
                            <button th:method="delete" th:onclick="window.location.href = '/admin/delete/priority/[[${message.getId}]]';" type="button">Удалить</button>
                        </div>
                    </div>
                </div>
            </div>

    <p th:case="roles">
        <table th:if="${roles}" class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th scope="col">Id</th>
                <th scope="col">Description</th>
            </tr>
            </thead>
            <tbody th:each="message : ${roles}">
            <tr>
                <td th:text="${message.getId}"></td>
                <td th:text="${message.getRole}"></td>
            </tr>
            </tbody>
        </table>
</div>

<div class="modal fade" id="formNew" tabindex="-1" aria-labelledby="label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 th:if="${users}" class="modal-title" th:id="label" th:text="'Новый пользователь'">New User</h5>
                <h5 th:if="${types}" class="modal-title" th:id="label" th:text="'Новый тип заявки'">New User</h5>
                <h5 th:if="${priorities}" class="modal-title" th:id="label" th:text="'Новый приоритет заявки'">New User</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-bs-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul th:if="${users}" th:insert="forms::userForm"></ul>
                <ul th:if="${types}" th:insert="forms::typeForm"></ul>
                <ul th:if="${priorities}" th:insert="forms::priorityForm"></ul>
            </div>

        </div>
    </div>
</div>
<!--suppress RequiredAttributes -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

</body>
</html>
